var TourHouse=function(e){function t(e){return void 0===e.length?!0:!1}function o(e,t){e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0, 0, 0, 1)";var o=t.getBoundingClientRect(),n=o.width,r=o.height,i=o.left+$(window).scrollLeft(),s=o.top+$(window).scrollTop(),l=getComputedStyle(t).borderRadius;if(l=l.replace("px",""),console.log(l),l>0){e.lineJoin="round",e.lineWidth=l;var p=i+l/2,a=s+l/2,d=n-l,c=r-l;e.strokeRect(p,a,d,c),e.fillRect(p,a,d,c),b[y].pos={x:p,y:a,width:d,height:c},e.globalCompositeOperation="source-atop",e.shadowColor="#999",e.shadowBlur=10,e.shadowOffsetX=10,e.shadowOffsetY=10,e.fillRect(p,a,d,c)}else e.fillRect(i,s,n,r),b[y].pos={x:i,y:s,width:n,height:r},e.globalCompositeOperation="source-atop",e.shadowColor="#999",e.shadowBlur=10,e.shadowOffsetX=10,e.shadowOffsetY=10,e.fillRect(i,s,n,r)}function n(e,t){var o=b[y].textProp,n=b[y].pos,r=document.createElement("h3");r.className=o.className,r.innerHTML=e;var i=document.createElement("div");if(i.className="tour_house_text_wrapper",i.style.position="absolute",i.appendChild(r),document.body.appendChild(i),!o.show)return 1;var s=i.getBoundingClientRect();if(o.relativeToOrderedElement)if(o.appearsBelow||null!==o.position)if(o.appearsBelow&&null===o.position){var l=n.y+n.height+o.margin+s.height;l>$(window).height()?console.warn("text element containing: ",e,"goes beyond the visible page. Please change appearsBelow to false"):(i.style.left=n.x+"px",i.style.top=n.y+n.height+o.margin+"px")}else console.warn("cannot have textProp 'relativeToOrderedElement: true' and 'position: [not null]'!");else{var l=n.y-o.margin-s.height;0>l?console.warn("text element containing: ",e,"goes beyond the visible page. Please change appearsBelow to true"):(i.style.left=n.x+"px",i.style.top=l+"px")}else null!==o.position||console.warn("no settings for text styles. Set properties or change relativeToOrderedElement to true");i.parentNode.removeChild(i),v.appendChild(i)}function r(){if(!g.properties.showButtons)return 1;var e=g.properties.showPrev&&0!==y?!0:!1;f=document.createElement("button"),f.innerHTML=y+1===C?g.properties.nextEndLabel:g.properties.nextLabel,f.className="tour_house_step_button",f.id="tour_house_next_button",f.style.position="absolute",document.body.appendChild(f);var o=f.getBoundingClientRect(),n=void 0;e&&(x=document.createElement("button"),x.innerHTML=g.properties.prevLabel,x.className="tour_house_step_button",x.id="tour_house_prev_button",x.style.position="absolute",document.body.appendChild(x),n=x.getBoundingClientRect());var r=t(b[y].elements)?b[y].elements.getBoundingClientRect():b[y].elements[0].getBoundingClientRect(),i=$(window).scrollTop(),s=$(window).scrollLeft();if(b[y].textProp.appearsBelow?(f.style.top=r.top+i-o.height-b[y].textProp.margin+"px",f.style.left=r.right+s-o.width+"px",e&&(x.style.top=r.top+i-n.height-b[y].textProp.margin+"px",x.style.left=r.right-o.width-n.width-b[y].textProp.margin+"px")):(f.style.top=r.bottom+i+b[y].textProp.margin+"px",f.style.left=r.right+s-o.width+"px",e&&(x.style.top=r.bottom+i+b[y].textProp.margin+"px",x.style.left=r.right+s-n.width-o.width-b[y].textProp.margin+"px")),g.properties.showStepNumber){o=f.getBoundingClientRect(),steps=document.createElement("div"),steps.id="tour_house_steps_left",document.body.appendChild(steps);var l=steps.getBoundingClientRect();steps.innerHTML="<p>"+(y+1)+"/"+C+"</p>",steps.style.top=o.top+i+20+b[y].textProp.margin+"px",steps.style.left=o.right+b[y].textProp.margin+"px",v.appendChild(steps)}if(g.properties.showX){w=document.createElement("div"),w.id="tour_house_exit_button",document.body.appendChild(w);var a=w.getBoundingClientRect();w.style.top=r.top+i-o.height-2*o.height-b[y].textProp.margin>0?r.top+i-o.height-2*o.height-b[y].textProp.margin+"px":r.bottom+i+o.height+2*o.height+b[y].textProp.margin+"px",w.style.left=r.right+s-a.width+25+"px",void 0===g.properties.exitButtonText?w.style.backgroundImage="url("+g.properties.exitButton+")":w.innerHTML="<h2>"+g.properties.exitButtonText+"</h2>",w.style.backgroundSize="contain",document.body.removeChild(w),w.addEventListener("click",p,!1),v.appendChild(w)}e&&(document.body.removeChild(x),v.appendChild(x),x.addEventListener("click",b[y].textProp.goToPrev,!1)),document.body.removeChild(f),v.appendChild(f),f.addEventListener("click",b[y].textProp.goToNext,!1)}function i(){var e=document.body.firstChild;m=document.createElement("canvas"),m.id="tour_house_overlay",v=document.createElement("div"),v.id="tour_house_wrapper",m.appendChild(v);var i=y,s=b[i],l=t(s.elements);m=document.createElement("canvas"),m.height=$(window).height()+2e3,m.width=$(window).width(),m.style.opacity=g.properties.screenOpacity,m.style.position="absolute";var p=m.getContext("2d");if(p.fillStyle=g.properties.screenColor,p.fillRect(0,0,m.width,m.height),l)o(p,s.elements);else for(var a=s.elements.length-1;a>=0;a--)o(p,s.elements[a]);if("string"==typeof s.texts)switch(l){case!0:n(s.texts,s.elements);break;case!1:n(s.texts,s.elements[i])}else if(l)for(var a=s.texts.length-1;a>=0;a--)n(s.texts[a],s.elements);else for(var a=s.texts.length-1;a>=0;a--)n(s.texts[a],s.elements[i]);return g.properties.showButtons?(r(),document.body.insertBefore(m,document.body.firstChild),document.body.insertBefore(v,document.body.firstChild),void $("#tour_house_wrapper").fadeIn(800)):1}function s(e){var t=g.properties,o={screenColor:t.screenColor,screenOpacity:t.screenOpacity,borderShow:t.borderShow,borderCol:t.borderCol,nextLabel:t.nextLabel,nextEndLabel:t.nextEndLabel,prevLabel:t.prevLabel,showButtons:t.showButtons,showPrev:t.showPrev,exitButtonText:t.exitButtonText,exitImage:t.exitImage,showX:t.showX,exitOnOut:t.exitOnOut,showStepNumber:t.showStepNumber,onPageStart:t.onPageStart,goTo:function(e){},clearAll:function(){}};return"string"==typeof e.screenColor&&(o.screenColor=e.screenColor),!isNaN(e.screenOpacity)&&e.screenOpacity<=1&&e.screenOpacity>=0&&(o.screenOpacity=e.screenOpacity),"string"==typeof e.nextLabel&&(o.nextLabel=e.nextLabel),"string"==typeof e.nextEndLabel&&(o.nextEndLabel=e.nextEndLabel),"string"==typeof e.prevLabel&&(o.prevLabel=e.prevLabel),"boolean"==typeof e.showButtons&&(o.showButtons=e.showButtons),"boolean"==typeof e.showPrev&&(o.showPrev=e.showPrev),"string"==typeof e.exitImage&&(o.exitImage=e.exitImage),"string"==typeof e.exitButtonText&&(o.exitButtonText=e.exitButtonText),"boolean"==typeof e.showX&&(o.showX=e.showX),"boolean"==typeof e.borderShow&&(o.borderShow=e.borderShow),"string"==typeof e.borderCol&&(o.borderCol=e.borderCol),"boolean"==typeof e.exitOnOut&&(o.exitOnOut=e.exitOnOut),"boolean"==typeof e.showStepNumber&&(o.showStepNumber=e.showStepNumber),"boolean"==typeof e.onPageStart&&(o.onPageStart=e.onPageStart),"function"==typeof e.clearAll&&(o.clearAll=e.clearAll),o}function l(e){console.log("CARDPROP EVAL");var t={relativeToOrderedElement:!0,appearsBelow:!1,position:null,margin:10,show:!0,className:"tour_texts",goToNext:function(){g.goToNext()},goToPrev:function(){g.goToPrev()}};return"boolean"==typeof e.relativeToOrderedElement&&(t.relativeToOrderedElement=e.relativeToOrderedElement),"boolean"==typeof e.appearsBelow&&(t.appearsBelow=e.appearsBelow),("object"===e.position||void 0!==e.position&&"center"===e.position.toLower())&&(t.position=e.position),"number"==typeof e.margin&&(t.margin=e.margin),"boolean"==typeof e.show&&(t.show=e.show),"string"==typeof e.className&&(t.className=e.className),"function"==typeof e.goToNext&&(t.goToNext=e.goToNext),"function"==typeof e.goToPrev&&(t.goToPrev=e.goToPrev),t}function p(){$("#tour_house_overlay").fadeOut(),document.body.removeChild(document.body.firstChild),document.body.removeChild(document.body.firstChild)}function a(e,t,o){var n=!1;return(t>e||e>o)&&(n=!0),n}function d(e,t,o){var n=!1;return(t>e||e>o)&&(n=!0),n}function c(){B=!0}function u(e){if(!B||!g.properties.exitOnOut)return 1;var o,n,r,i,s=void 0!==f?f.getBoundingClientRect():void 0,l=void 0!==x?x.getBoundingClientRect():void 0,p=b[y].elements;if(t(p)){var c=p.getBoundingClientRect();o=c.left,n=c.right,r=c.top+$(window).scrollTop(),i=c.bottom+$(window).scrollTop(),(a(e.clientX+document.body.scrollLeft,o,n)||d(e.clientY+document.body.scrollTop,r,i))&&void 0!==s&&(a(e.clientX+document.body.scrollLeft,s.left,s.right)||d(e.clientY+document.body.scrollTop,s.top+$(window).scrollTop(),s.bottom+$(window).scrollTop()))&&void 0!==l&&(a(e.clientX+document.body.scrollLeft,l.left,l.right)||d(e.clientY+document.body.scrollTop,l.top+$(window).scrollTop(),l.bottom+$(window).scrollTop()))&&g.stop()}else{for(var u=0,h=p.length-1;h>=0;h--){var c=p[h].getBoundingClientRect();o=c.left,n=c.right,r=c.top+$(window).scrollTop(),i=c.bottom+$(window).scrollTop(),(a(e.clientX+document.body.scrollLeft,o,n)||d(e.clientY+document.body.scrollTop,r,i))&&u++}u===p.length&&g.stop()}B=!1}function h(e){switch(e.keyCode){case 37:b[y].textProp.goToPrev();break;case 39:b[y].textProp.goToNext();break;case 27:p(),g.stop();break;default:console.log(e)}}var g=this instanceof TourHouse?this:new TourHouse;this.properties={screenColor:"#000000",screenOpacity:.5,borderShow:!0,borderCol:"#C4C4C4",nextLabel:"Next",nextEndLabel:"Done",prevLabel:"Prev",showButtons:!0,showPrev:!0,exitButtonText:void 0,exitImage:"images/cross.png",showX:!0,exitOnOut:!1,showStepNumber:!0,onPageStart:!1,goTo:function(e){},clearAll:function(){}},void 0!==e&&(g.properties=s(e));var m,f,x,w,v,b=[],y=0,T={AUTHOUR:"Nadia S.canvas.",VERSION:"1.3.1",LATEST:"19 June, 2015"},C=0,P=function(e,t){var o=this;this.elements=e,this.pos=null,this.texts=t,this.textProp={relativeToOrderedElement:!0,appearsBelow:!1,position:null,margin:10,show:!0,className:"tour_texts",goToNext:function(){g.goToNext()},goToPrev:function(){g.goToPrev()}},this.step=C};this.stats=function(){console.log("CANVAS ",m),console.log(" deckBox ",v)};var B=!1;return this.push=function(e,t,o){var n=new P(e,t);if("object"==typeof o){var r=l(o);n.textProp=r}n.position=C++,b.push(n)},this.goToNext=function(){return y+1>=C?(console.log("must stop"),p(),g.stop(),1):(p(),y++,void i())},this.goToPrev=function(){y-1>=0&&(p(),y--,i())},this.start=function(){i(),g.properties.exitOnOut&&(document.addEventListener("mousedown",c),document.addEventListener("mouseup",u)),document.addEventListener("keydown",h)},this.stop=function(){document.removeEventListener("keydown",h),g.properties.exitOnOut&&(document.removeEventListener("onmousedown",c),document.removeEventListener("onmouseup",u)),g.properties.showButtons&&(document.getElementById("tour_house_next_button").removeEventListener("click",b[y].textProp.goToNext()),g.properties.showPrev&&y>0&&document.getElementById("tour_house_prev_button").removeEventListener("click",b[y].textProp.goToPrev()),g.properties.showX&&document.getElementById("tour_house_exit_button").removeEventListener("click",g.stop))},g};